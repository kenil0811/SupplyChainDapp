<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="Aneesh Bhatnagar">
	<title>Performing Ethereum Operations</title>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="css/style.css">
</head>
<body>
	<div id="loader"></div>
	<div class="container">
		<div class="row">
			<div class="col-12">
				<h1 class="title">Part 2: Operations on Ethereum</h1>
			</div>
		</div>
		
		<center><h2>Admin Node Info</h2></center>
		<div class="row">
			<div class="col-2 text-center">
				<label for="enodeAddress" style="margin-top:8px;">Enode</label>
				<br/>
				<label for="coinbaseAddress" style="margin-top:15px;">Address</label>
				<br/>
			</div>
			<div class="col-10">
				<input type="text" style="margin-bottom: 10px;" class="form-control" id="enodeAddress" placeholder="Your Enode address" readonly>
				<input type="text" class="form-control" id="coinbaseAddress" placeholder="Your Coinbase address" readonly>
			</div>
		</div>
		<div class="row justify-content-center" style="margin-top: 25px;">
			<div id="accordion" role="tablist" aria-multiselectable="true">
				<div class="card">
					<div class="card-header" role="tab" id="headingOne">
						<h5 class="mb-0"><a data-toggle="collapse" data-parent="#accordion" href="#connectPeer" aria-expanded="true" aria-controls="connectPeer">Add Peer</a></h5>
					</div>
					<div id="connectPeer" class="collapse show" role="tabpanel" aria-labelledby="headingOne">
						<div class="card-block">
							<p>We will connect the two nodes that you created to each other. To do so, we will add the enode of one of the nodes to the other and they both will be connected. Use the button below to connect them.</p>
							<form id="connectToPeer" class="data-entry-form">
								<div class="form-group row text-center">
									<div class="col-12">
										<button type="submit" class="btn btn-primary">Connect Peers</button>
									</div>
								</div>
								<label for="peerStatus">Connected Peer Status</label>
								<input type="text" class="form-control" id="peerStatus" placeholder="Add Peer Status" readonly>
							</form>
						</div>
					</div>
				</div>
				<div class="card">
					<div class="card-header" role="tab" id="headingTwo">
						<h5 class="mb-0"><a data-toggle="collapse" data-parent="#accordion" href="#checkPeerCount" aria-expanded="true" aria-controls="checkPeerCount">Check Peer Count</a></h5>
					</div>
					<div id="checkPeerCount" class="collapse" role="tabpanel" aria-labelledby="headingTwo">
						<div class="card-block">
							<p>If you want to check the count of connected peers, press the button below to query and return the result.</p>
							<div class="row text-center">
								<div class="col-12">
									<form id="checkPeer" class="data-entry-form">
										<div class="form-group row">
											<div class="col-12">
												<button type="submit" class="btn btn-primary">Check Peer Count</button>
											</div>
										</div>
										<label for="peerCount">Connected Peer Count</label>
										<input type="text" class="form-control" id="peerCount" placeholder="Connected Peer Count" readonly>
									</form>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="card">
					<div class="card-header" role="tab" id="headingSix">
						<h5 class="mb-0"><a data-toggle="collapse" data-parent="#accordion" href="#checkBalance" aria-expanded="true" aria-controls="checkBalance">Check Balance</a></h5>
					</div>
					<div id="checkBalance" class="collapse" role="tabpanel" aria-labelledby="headingSix">
						<div class="card-block">
							<p>If you want to check your balance, press the button below to query and return the result for all the accounts.</p>
							<div class="row text-center">
								<div class="col-12">
									<form id="checkBalanceForm" class="data-entry-form">
										<div class="form-group row">
											<div class="col-12 text-center">
												<button type="submit" class="btn btn-primary">Check Balance</button><br/><br/>
												<input type="text" class="form-control" id="balanceStatus" placeholder="Status" readonly>
											</div>
										</div>
										<div class="row">
											<div class="col-6">
												<label for="accountAddress">Account Address</label>
											</div>
											<div class="col-3">
												<label for="balanceWei">Balance (in Weis)</label>
											</div>
											<div class="col-3">
												<label for="balanceEther">Balance (in Ethers)</label>
											</div>
										</div>
										<div class="row" id="accountList">
											
										</div>	
									</form>
								</div>
							</div>
							
						</div>
					</div>
				</div>
				<div class="card">
					<div class="card-header" role="tab" id="headingFive">
						<h5 class="mb-0"><a data-toggle="collapse" data-parent="#accordion" href="#sendTransaction" aria-expanded="true" aria-controls="sendTransaction">Send Ehter to players</a></h5>
					</div>
					<div id="sendTransaction" class="collapse" role="tabpanel" aria-labelledby="headingFive">
						<div class="card-block">
							<p>You can send some ether to the players so that they can interact with the blockchain and play the game</p>
							<p>Plese check wheter all players have created their account address. You can send ether only after the players have created the accounts.</p>

								<center><button type="button" class="btn btn-primary" id="checkAddresses">Check Accounts Created</button></center> 
								<label for="checkAddressesStatus">Response</label>
								<input type="text" class="form-control" id="checkAddressesStatus" placeholder="Response" readonly>
								<br>
								<br>
								<form id="sendTransactionForm" class="data-entry-form">
									<div class="form-group row">
										<div class="col-4">
											<input type="text" autocomplete="off" class="form-control" id="sendAmount" placeholder="Enter the amount (in Ethers)">	
										</div>
										<div class="col-8">
											<button type="submit" class="btn btn-primary" id="sendTransactionButton">Send Transaction</button>
										</div>
									</div>
									<label for="transactionStatus">Transaction Status</label>
									<input type="text" class="form-control" id="transactionStatus" placeholder="Transaction Status" readonly>
								</form>
								
						</div>
					</div>
				</div>
				<div class="card">
					<div class="card-header" role="tab" id="headingSeven">
						<h5 class="mb-0"><a data-toggle="collapse" data-parent="#accordion" href="#checkTransaction" aria-expanded="true" aria-controls="checkTransaction">Check Transaction Status</a></h5>
					</div>
					<div id="checkTransaction" class="collapse" role="tabpanel" aria-labelledby="headingSeven">
						<div class="card-block">
							<p>If you want to check the status of transactions, press the button below to query the blockchain and return the result.</p>
							<p>For your blockchain, since the difficulty is not too high, every transaction is mined pretty quickly. You should stop the miner and then submit a transaction. After that, if you check you will find that there is a pending transaction. Start the miner to send the transaction through.</p>
							<div class="row">
								<div class="col-12">
									<form id="checkTransactionForm" class="data-entry-form">
										<div class="form-group row">
											<div class="col-12 text-center">
												<button type="submit" class="btn btn-primary">Check Transaction Status</button>
											</div>
										</div>
										<label for="pendingTransactions">Pending Transactions</label>
										<input type="text" class="form-control" id="pendingTransactions" placeholder="Pending Transactions" readonly>
										<label for="queuedTransactions">Queued Transactions</label>
										<input type="text" class="form-control" id="queuedTransactions" placeholder="Queued Transactions" readonly>
									</form>
								</div>
							</div>
							
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-12 text-center">
				<p><b>Note</b>: You can deploy the smart contract once the players are added as peers and some ether has been transferred to the players to play the game</p>
				<button type="button" class="btn btn-primary btn-large" id="deployContract">Deploy Contract</button>
			</div>
		</div>
	</div>
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/popper.min.js"></script>
	<script type="text/javascript" src="js/bootstrap.min.js"></script>
	<script type="text/javascript" src="js/script.js"></script>
	<script>
		$(window).on('load', function(){
			$.ajax({
				url: '/api/startWeb3', 
				type: 'POST', 
				contentType: 'application/json'}
			).done(function(resp){
				if(resp.status == "error"){
					alert(resp.errorDetails);
					window.location.href = "./adminSetup1.html"
				}else if(resp.status == "complete"){
					$("#enodeAddress").val(resp.enode1);
					$("#coinbaseAddress").val(resp.coinbase1);
					$("#loader").fadeOut('slow');
				}
			});
		});
	</script>
</body>
</html>